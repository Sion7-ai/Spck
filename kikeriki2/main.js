document.addEventListener('DOMContentLoaded',function(){const e=document.getElementById('preloader'),t=document.body;if("undefined"==typeof gsap||"undefined"==typeof ScrollTrigger||"undefined"==typeof ScrollToPlugin){console.error('GSAP oder eines seiner Plugins konnte nicht geladen werden.');if(e){e.classList.add('loaded');e.addEventListener('transitionend',()=>{e&&(e.style.display='none')},{once:!0});console.log("Preloader fallback: GSAP not loaded, hiding preloader via CSS class.")}t&&t.classList.remove('preloading');const o=document.getElementById('mobile-menu-toggle'),n=document.getElementById('mobile-menu');return void(o&&n&&o.addEventListener('click',()=>{const e=n.classList.toggle('open-no-gsap');document.body.classList.toggle('no-scroll',e),o.setAttribute('aria-expanded',e)}))}gsap.registerPlugin(ScrollTrigger,ScrollToPlugin);if(e){setTimeout(()=>{gsap.to(e,{autoAlpha:0,duration:.6,ease:"power2.out",onComplete:()=>{e&&(e.style.display='none'),t&&t.classList.remove('preloading'),console.log("Preloader normal fade: GSAP loaded, preloader hidden via GSAP."),ScrollTrigger.refresh()}})},1600)}const o=document.getElementById('header'),n=document.getElementById('mobile-menu-toggle'),i=document.getElementById('mobile-menu'),r=document.querySelectorAll('.nav-item, .mobile-nav-item'),a=document.querySelectorAll('.page-section');let s=0;ScrollTrigger.create({trigger:"body",start:"top top",end:"bottom bottom",onUpdate:e=>{const t=e.scrollY;t>100?o.classList.add('scrolled'):o.classList.remove('scrolled');const n=document.querySelector('.hero-slide.active');if(n){const e=n.dataset.slideTheme||'dark',i=document.getElementById('hero');let r=.5*window.innerHeight;i.getBoundingClientRect().bottom>r?o.classList.toggle('light-theme','light'===e):o.classList.contains('scrolled')||o.classList.remove('light-theme')}else t<100&&o.classList.remove('light-theme')}});if(n&&i){const e=i.querySelectorAll('.mobile-nav-item'),t=gsap.timeline({paused:!0,reversed:!0});t.to(i,{autoAlpha:1,y:'0%',duration:.5,ease:"power3.inOut"}).fromTo(e,{autoAlpha:0,y:30},{autoAlpha:1,y:0,stagger:.07,duration:.4,ease:"power2.out"},"-=.2"),n.addEventListener('click',()=>{const e="false"===n.getAttribute('aria-expanded');n.setAttribute('aria-expanded',e),body.classList.toggle('no-scroll',e),i.classList.toggle('open',e),e?t.play():t.reverse()})}function l(e){const t=document.querySelector(e);if(t){let n=o.offsetHeight;"#hero"===e&&(n=0),gsap.to(window,{duration:1.5,scrollTo:{y:t,offsetY:n},ease:"power4.inOut"}),"true"===n.getAttribute('aria-expanded')&&setTimeout(()=>{n.click()},100)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener('click',function(e){e.preventDefault(),l(this.getAttribute('href'))})});function c(e){r.forEach(t=>{t.classList.toggle('active-link',t.dataset.section===e)})}if(a.length>0&&r.length>0){a.forEach(e=>{ScrollTrigger.create({trigger:e,start:()=>`top ${o.offsetHeight+.35*window.innerHeight}px`,end:()=>`bottom ${o.offsetHeight+.35*window.innerHeight}px`,onToggle:t=>{t.isActive&&c(e.id)},onEnterBack:()=>c(e.id)})});setTimeout(()=>{let e=null;for(let t of a)if(ScrollTrigger.isInViewport(t,-.4)){e=t.id;break}e?c(e):a.length>0&&window.scrollY<a[0].offsetTop+.5*a[0].offsetHeight&&"hero"===a[0].id&&c("hero")},200)}window.location.hash?c(window.location.hash.substring(1)):a.length>0&&ScrollTrigger.isInViewport(a[0],-.5)&&"hero"===a[0].id&&c("hero");const d=document.querySelector('.hero-slider-wrapper'),u=gsap.utils.toArray('.hero-slide',d),m=document.querySelectorAll('.hero-slider-arrow'),p=document.querySelector('.hero-slider-dots');let g=0,h,f=!1;if(u.length>0){u.forEach((e,t)=>{const o=document.createElement('span');o.classList.add('dot'),o.dataset.slide=t,0===t&&o.classList.add('active'),o.addEventListener('click',()=>{f||y(t)}),p&&p.appendChild(o)});const v=gsap.utils.toArray('.hero-slider-dots .dot');function k(e){f=!0;const t=gsap.timeline({onComplete:()=>f=!1}),n=e.querySelector('.hero-image-bg'),i=e.querySelectorAll('.animate-hero-item');return gsap.set(e,{autoAlpha:1}),t.fromTo(n,{scale:1.15,autoAlpha:0},{scale:1,autoAlpha:.8,duration:1.4,ease:"power3.out"}),t.fromTo(i,{autoAlpha:0,y:40,skewY:2},{autoAlpha:1,y:0,skewY:0,stagger:.1,duration:.8,ease:"power3.out"},"-=1.0"),t}function y(t,n="next"){if(t===g&&u[t].classList.contains("active")||f)return;f=!0;const i=u[g],r=u[t];clearInterval(h);const a=function(e){f=!0;const t=gsap.timeline({onComplete:()=>f=!1}),n=e.querySelector(".hero-image-bg"),i=e.querySelectorAll(".animate-hero-item");return t.to(i,{autoAlpha:0,y:-30,stagger:.05,duration:.5,ease:"power2.in"}).to(n,{autoAlpha:0,scale:1.05,duration:.7,ease:"power2.in"},"=-.4").set(e,{autoAlpha:0}),t}(i);a.eventCallback("onComplete",()=>{i.classList.remove("active"),r.classList.add("active"),k(r).eventCallback("onComplete",()=>{f=!1,b()}),v.forEach((e,o)=>e.classList.toggle("active",o===t)),g=t;const e=r.dataset.slideTheme||"dark";o.classList.toggle("light-theme","light"===e)})}function b(){clearInterval(h),h=setInterval(()=>{f||y((g+1)%u.length,"next")},7e3)}gsap.set(u,{autoAlpha:0}),u[0].classList.add("active"),k(u[0]).eventCallback("onComplete",()=>{f=!1,b()}),o.classList.toggle("light-theme","light"===u[0].dataset.slideTheme),m.forEach(e=>{e.addEventListener("click",()=>{if(f)return;let t;"next"===e.classList[1]?t=(g+1)%u.length:t=(g-1+u.length)%u.length,y(t)})})}const b=document.querySelector(".marquee-content");b&&b.children.length>0&&gsap.to(b,{x:-b.scrollWidth/2,duration:30,ease:"none",repeat:-1});if(window.matchMedia("(min-width: 769px)").matches&&document.querySelector(".problem-solution-container")&&document.querySelector(".sticky-title-column")&&document.querySelector(".scrollable-content-column")){ScrollTrigger.create({trigger:".problem-solution-container",pin:".sticky-title-column",start:"top top+="+ (o.offsetHeight+40),end:()=>"+="+(document.querySelector(".scrollable-content-column").offsetHeight-document.querySelector(".sticky-title-column").offsetHeight-40),pinSpacing:"auto"})}const L=document.querySelector(".horizontal-panels-wrapper");if(window.matchMedia("(min-width: 769px)").matches&&L&&L.children.length>0){const e=gsap.utils.toArray(".horizontal-panel",L),t=document.querySelector(".horizontal-scroll-container"),n=gsap.to(e,{xPercent:-100*(e.length-1),ease:"none",scrollTrigger:{trigger:t,pin:!0,scrub:1.2,snap:{snapTo:1/(e.length-1),duration:{min:.2,max:.6},ease:"power1.inOut"},end:()=>"+="+(L.offsetWidth-window.innerWidth)}});e.forEach(e=>{const t=e.querySelector(".panel-image");t&&gsap.fromTo(t,{backgroundPosition:"70% 50%"},{backgroundPosition:"30% 50%",ease:"none",scrollTrigger:{trigger:e,containerAnimation:n,start:"left right",end:"right left",scrub:!0}})})};const S=document.querySelectorAll(".accordion-minimal-item");S.forEach(e=>{const t=e.querySelector(".accordion-minimal-header"),o=e.querySelector(".accordion-minimal-content"),n=t.querySelector(".accordion-minimal-icon");t.addEventListener("click",()=>{const r=e.classList.toggle("active");t.setAttribute("aria-expanded",r),n&&n.setAttribute("icon",r?"mdi:minus":"mdi:plus"),gsap.to(o,{maxHeight:r?o.scrollHeight:0,paddingBottom:r?"var(--spacing-l)":0,duration:.5,ease:"power3.inOut"})})});const C=gsap.utils.toArray(".testimonial-slide-modern"),w=document.querySelector(".prev-testimonial-modern"),x=document.querySelector(".next-testimonial-modern");letA=0,P=!1;if(C.length>0){function F(e,t="next"){if(0===C.length||P)return;P=!0;const o=C[A],n=C[e];gsap.timeline({onComplete:()=>P=!1}).to(o,{autoAlpha:0,xPercent:"next"===t?-25:25,duration:.4,ease:"power2.in"}).set(o,{display:"none"}).set(n,{display:"block",autoAlpha:0,xPercent:"next"===t?25:-25,scale:.98}).to(n,{autoAlpha:1,xPercent:0,scale:1,duration:.55,ease:"power3.out"}),A=e,C.forEach(e=>e.classList.remove("active")),n.classList.add("active")}gsap.set(C,{display:"none",autoAlpha:0}),gsap.set(C[0],{display:"block",autoAlpha:1}),C[0].classList.add("active"),w&&x&&(x.addEventListener("click",()=>{let e=(A+1)%C.length;F(e,"next")}),w.addEventListener("click",()=>{let e=(A-1+C.length)%C.length;F(e,"prev")}))}const F=gsap.utils.toArray(".animate-on-scroll, .animate-sticky-title, .animate-scroll-item");F.forEach(e=>{const t=parseFloat(e.dataset.delay)||0;let o=50,n=0,i=1;e.classList.contains("animate-from-left")&&(n=-50,o=0),e.classList.contains("animate-from-right")&&(n=50,o=0),e.classList.contains("animate-scale-in")&&(i=.9),gsap.fromTo(e,{autoAlpha:0,y:o,x:n,scale:i},{autoAlpha:1,y:0,x:0,scale:1,duration:1,delay:t,scrollTrigger:{trigger:e,start:"top 88%",toggleActions:"play none none none"},ease:"power3.out"})}),document.querySelectorAll("#current-year-footer, #current-year-mobile").forEach(e=>{e&&(e.textContent=(new Date).getFullYear())}),ScrollTrigger.refresh()});